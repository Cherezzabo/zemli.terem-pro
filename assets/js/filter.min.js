"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),Filter=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"area",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"area";_classCallCheck(this,t),this.defaultType=n,this.defaultObject=this.getJsonObject(a),this.wrapperFilter=e,this.FormHeader='<form action="" method="" id="filter" class="filter-form">',this.FormFooter='<div class="filter-button">\n\t\t\t\t\t\t\t\t<button class="refresh-button" type="reset">Сбросить</button>\n\t\t\t\t\t\t\t\t<button class="submit-button" type="submit">Найти</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</form>',this.FormText="",this.bindObjInputs=[],this.PriceObjects=[]}return _createClass(t,[{key:"CreatePriceObject",value:function(t){this.neme=t,this.textFrom=0,this.textTo=0,this.text=""}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultObject,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=0;for(var n in t){var r=t[n];if(!r["default"])for(var s in r){var i=r[s];this.PriceObjects[a]={name:i[0].name,textFrom:0,textTo:0,text:""},a++}}if(e&&($(this.wrapperFilter).html(""),this.FormText=""),t.selects)for(var o in t.selects){var l=t.selects[o][0];this.FormText+=this.tmpSelect(l)}if(t.ranges)for(var d in t.ranges){var p=t.ranges[d][0];this.bindObjInputs.push(p),this.FormText+=this.tmpRange(p)}$(this.wrapperFilter).html(this.FormHeader+" "+this.FormText+this.FormFooter),this.Binds(),this.BindListSelect(),this.BindRangeInput(this.bindObjInputs)}},{key:"Binds",value:function(){var t=this,e="";$(this.wrapperFilter+" > form").bind("click",function(a){var n=$(a.target).attr("id")?$(a.target).attr("id"):$(a.target).attr("data-type");n&&("lots"!=n&&"area"!=n||(e=t.getJsonObject(n),t.render(e,1)))}),$(this.wrapperFilter+" > form").find(".refresh-button").bind("click",function(e){t.render(t.defaultObject,1)})}},{key:"BindListSelect",value:function(){$(this.wrapperFilter+" li").on("click",function(t){var e=t.target||window.target,a=$(e).parent(),n=$(e).html(),r=$(this).parent().prev(),s=$(".refresh-button");a.addClass("active"),a.siblings().removeClass("active"),r.html(n+'<span class="my-caret"></span>').prev().val(n),"lots"==$(e).attr("data-type")||"area"==$(e).attr("data-type")?s.hide():s.show()})}},{key:"BindRangeInput",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this,a=t,n=$(".refresh-button");t&&$(""+this.wrapperFilter).on("input","input",function(t){var r=t.target||window.target,s=parseInt(Math.abs($(r).val())),i=$(this).parent().parent().prev(),o="",l="",d="",p="";for(var u in a){var c=a[u];if($(r).attr("data-name")==""+c.name){o=""+c.name,d=c.type;for(var m in e.PriceObjects)c.name==e.PriceObjects[m].name&&(p=m)}if($(r).attr("id")==c.name+"-from"&&(e.PriceObjects[p].textFrom=e.textCombinate("text-from",s)),$(r).attr("id")==c.name+"-up-to"&&(e.PriceObjects[p].textTo=e.textCombinate("text-up-to",s)),p){var v="";e.PriceObjects[p].textFrom&&(v+=e.PriceObjects[p].textFrom+" "+d+" "),e.PriceObjects[p].textTo&&(v+=e.PriceObjects[p].textTo+" "+d),(!e.PriceObjects[p].textFrom&&!e.PriceObjects[p].textTo&&$(r).attr("data-name")==""+c.name||!v&&$(r).attr("data-name")==""+c.name)&&(v=c.name_text+' <span class="my-caret"></span>'),$(r).attr("data-name")==""+c.name&&(o=""+c.name,l=c.name_text+' <span class="my-caret"></span>')}}v?i.html(v):$("#"+o+"Dropdown").html(l),n.show()})}},{key:"textCombinate",value:function(t,e){var a=!1;if("text-from"==t)var n="от";if("text-up-to"==t)var n="до";return!isNaN(e)&&e&&0!=e?(a=n,a+=" "+e):a=!1,a}},{key:"getJsonObject",value:function(t){var e="/assets/js/helpers/"+t+".helper.json",a=new XMLHttpRequest;return a.open("GET",e,!1),a.send(),200==a.status&&JSON.parse(a.responseText)}},{key:"tmpSelect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e="",a="",n=Object.keys(t.values);if(t&&t.values)if("type"==t.name){if("none"!=this.defaultType){if("area"==n[0]){var r='<li class="active"><a href="#" data-type="area" data-name="'+t.values.area+'">'+t.values.area+'</a></li>\n\t\t\t\t\t\t\t\t\t\t<li><a href="#" data-type="lots" data-name="'+t.values.lots+'">'+t.values.lots+"</a></li>";a=r}else if("lots"==n[0]){var s='<li><a href="#" data-type="area" data-name="'+t.values.area+'">'+t.values.area+'</a></li>\n\t\t\t\t\t\t\t\t\t\t\t<li class="active"><a href="#" data-type="lots" data-name="'+t.values.lots+'">'+t.values.lots+"</a></li>";a=s}e='<div class="dropdown">\n\t\t\t\t\t\t\t\t<input type="text" name="'+t.name+'" value="'+t.name_text+'" class="hidden">\n\t\t\t\t\t\t\t\t<button class="btn btn-filter btn-lg dropdown-toggle" type="button" id="'+t.name+'Dropdown" data-placeholder="'+t.name_text+'" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t\t\t\t\t\t'+t.name_text+'\n\t\t\t\t\t\t\t\t\t<span class="my-caret"></span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<ul class="dropdown-menu" aria-labelledby="dropdownRoad">\n\t\t\t\t\t\t\t\t\t<span class="arrow-top"></span>\n\t\t\t\t\t\t\t\t\t'+a+"\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</div>"}}else{for(var i in t.values){var o='<li><a href="#" data-name="'+t.values[i]+'">'+t.values[i]+"</a></li>";a+=o}e='<div class="dropdown">\n\t\t\t\t\t\t\t\t<input type="text" name="'+t.name+'" value="" class="hidden">\n\t\t\t\t\t\t\t\t<button class="btn btn-filter btn-lg dropdown-toggle" type="button" id="'+t.name+'Dropdown" data-placeholder="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t\t\t\t\t\t'+t.name_text+'\n\t\t\t\t\t\t\t\t\t<span class="my-caret"></span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<ul class="dropdown-menu" aria-labelledby="dropdownRoad">\n\t\t\t\t\t\t\t\t\t<span class="arrow-top"></span>\n\t\t\t\t\t\t\t\t\t'+a+"\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</div>"}return e}},{key:"tmpRange",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=null;return t.values&&(e='<div class="dropdown">\n\t\t\t\t\t\t<input type="text" name="'+t.name+'" value="" class="hidden">\n\t\t\t\t\t\t<button class="btn btn-filter btn-lg dropdown-toggle" type="button" id="'+t.name+'Dropdown" data-placeholder="Удаленность от МКАД" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t\t\t\t'+t.name_text+'\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<div class="dropdown-menu" aria-labelledby="'+t.name+'Dropdown">\n\t\t\t\t\t\t\t<span class="arrow-top"></span>\n\t\t\t\t\t\t\t<div class="range-box">\n\t\t\t\t\t\t\t\t<input type="number" name="'+t.name+'From" data-name="'+t.name+'" id="'+t.name+'-from" placeholder="'+t.min_text+" "+t.values.min+'">\n\t\t\t\t\t\t\t\t<span> - </span>\n\t\t\t\t\t\t\t\t<input type="number" name="'+t.name+'Upto" data-name="'+t.name+'" id="'+t.name+'-up-to" placeholder="'+t.max_text+" "+t.values.max+'">\n\t\t\t\t\t\t\t\t<span>'+t.type+"</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"),e}}]),t}();